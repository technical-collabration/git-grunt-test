!function(a){"use strict";var b={common:{init:function(){"undefined"!=typeof pafb_survey_instances&&a.each(pafb_survey_instances,function(c,d){var e=[];a.each(d.pafb_questions,function(a,b){("undefined"!=typeof b.question||"undefined"!=typeof b.confirmation)&&(b.column=a,e.push(b))}),a.each(e.reverse(),function(a,c){b.common.survey_question_tpl(c.type,c,a,d.pafb_survey_id,e.length)});var f=a("div[data-pafb-id="+d.pafb_survey_id+"] #pafb-survey-questions ul.items > li").size(),g=Math.floor(100/f*1);a("div[data-pafb-id="+d.pafb_survey_id+"] #pafb-bar").css("width",g+"%"),a("div[data-pafb-id="+d.pafb_survey_id+"] #pafb-survey-questions ul.items > li").each(function(b){0!=b&&a(this).hide(),a("div[id=pafb-feedback-form][data-pafb-id="+d.pafb_survey_id+"] .prev").hide(),a("div[id=pafb-feedback-form][data-pafb-id="+d.pafb_survey_id+"] .done").hide()}),a("div[id=pafb-feedback-form][data-pafb-id="+d.pafb_survey_id+"] .next").click(function(){var c=a("div[data-pafb-id="+d.pafb_survey_id+"] #pafb-survey-questions ul.items > li:visible"),e=c.data("required"),f=c.data("type"),g=a("div[id=pafb-feedback-form][data-pafb-id="+d.pafb_survey_id+"]").find("div[id=pafb-bar]");if(b.common.survey_validate_answer(f,e,c)){0!=a("div[data-pafb-id="+d.pafb_survey_id+"] #pafb-survey-questions ul.items > li:visible").next().length?(a("div[data-pafb-id="+d.pafb_survey_id+"] #pafb-survey-questions ul.items > li:visible").next().show().prev().hide(),a("div[id=pafb-feedback-form][data-pafb-id="+d.pafb_survey_id+"] .prev").show()):(a("div[data-pafb-id="+d.pafb_survey_id+"] #pafb-survey-questions ul.items > li:visible").hide(),a("div[data-pafb-id="+d.pafb_survey_id+"] #pafb-survey-questions ul.items > li:first").show()),a("div[data-pafb-id="+d.pafb_survey_id+"] #pafb-survey-questions ul.items > li:last").prev().is(":visible")&&(a("div[id=pafb-feedback-form][data-pafb-id="+d.pafb_survey_id+"] .next").hide(),a("div[id=pafb-feedback-form][data-pafb-id="+d.pafb_survey_id+"] .done").show());var h=a("div[data-pafb-id="+d.pafb_survey_id+"] #pafb-survey-questions ul.items > li:visible").data("progress");g.css("width",h+"%")}return!1}),a("div[id=pafb-feedback-form][data-pafb-id="+d.pafb_survey_id+"] .prev").click(function(){var b=a("div[id=pafb-feedback-form][data-pafb-id="+d.pafb_survey_id+"]").find("div[id=pafb-bar]");0!=a("div[data-pafb-id="+d.pafb_survey_id+"] #pafb-survey-questions ul.items > li:visible").prev().length?a("div[data-pafb-id="+d.pafb_survey_id+"] #pafb-survey-questions ul.items > li:visible").prev().show().next().hide():(a("div[data-pafb-id="+d.pafb_survey_id+"] #pafb-survey-questions ul.items > li:visible").hide(),a("div[data-pafb-id="+d.pafb_survey_id+"] #pafb-survey-questions ul.items > li:last").show()),a("div[data-pafb-id="+d.pafb_survey_id+"] #pafb-survey-questions ul.items > li:first").is(":visible")&&a("div[id=pafb-feedback-form][data-pafb-id="+d.pafb_survey_id+"] .prev").hide(),a("div[data-pafb-id="+d.pafb_survey_id+"] #pafb-survey-questions ul.items > li:not(:last)").is(":visible")&&(a("div[id=pafb-feedback-form][data-pafb-id="+d.pafb_survey_id+"] .next").show(),a("div[id=pafb-feedback-form][data-pafb-id="+d.pafb_survey_id+"] .done").hide());var c=a("div[data-pafb-id="+d.pafb_survey_id+"] #pafb-survey-questions ul.items > li:visible").data("progress");return b.css("width",c+"%"),!1}),a("div[id=pafb-feedback-form][data-pafb-id="+d.pafb_survey_id+"] .done").click(function(){var c=a("div[data-pafb-id="+d.pafb_survey_id+"] #pafb-survey-questions ul.items > li:visible"),e=c.data("required"),f=c.data("type");if(b.common.survey_validate_answer(f,e,c)){0!=a("div[data-pafb-id="+d.pafb_survey_id+"] #pafb-survey-questions ul.items > li:visible").next().length?a("div[data-pafb-id="+d.pafb_survey_id+"] #pafb-survey-questions ul.items > li:visible").next().show().prev().hide():(a("div[data-pafb-id="+d.pafb_survey_id+"] #pafb-survey-questions ul.items > li:visible").hide(),a("div[data-pafb-id="+d.pafb_survey_id+"] #pafb-survey-questions ul.items > li:first").show()),a("div[id=pafb-feedback-form][data-pafb-id="+d.pafb_survey_id+"] .next").hide(),a("div[id=pafb-feedback-form][data-pafb-id="+d.pafb_survey_id+"] .done").hide(),a("div[id=pafb-feedback-form][data-pafb-id="+d.pafb_survey_id+"] .prev").hide();var g=a("div[data-pafb-id="+d.pafb_survey_id+"] #pafb-survey-questions ul.items > li:visible").parent("ul.items").parent("div[id=pafb-survey-questions]").find("ul[class=items] > li"),h=a("div[id=pafb-feedback-form][data-pafb-id="+d.pafb_survey_id+"]").find("div[id=pafb-bar]");h.css("width","100%"),b.common.survey_feedbacks_save(g,d.pafb_survey_id)}return!1})})},survey_question_tpl:function(b,c,d,e,f){var g=a("#pafb-feedback-form[data-pafb-id="+e+"] #pafb-survey-questions ul.items"),h=[],i="undefined"!=typeof c.required?!0:!1,j=Math.floor(100/f*(d+1));switch(b){case"positive-negative":h.push(['<li data-progress="'+j+'" data-type="'+b+'" data-required="'+i+'" data-column="'+c.column+'" >','<span class="pafb-survey-question">'+c.question+"</span>","<ul>",'<li><input type="radio" name="pafb_feedbacks[pafb_answer]['+d+"]["+b+']" value="0" id="'+b+"_"+d+'_0"/> <label for="'+b+"_"+d+'_0">'+c.positive+"</label></li>",'<li><input type="radio" name="pafb_feedbacks[pafb_answer]['+d+"]["+b+']" value="1" id="'+b+"_"+d+'_1"/> <label for="'+b+"_"+d+'_1">'+c.negative+"</label></li>","</ul>","</li>"].join(""));break;case"choice":var k=[];k.push("<ul>");for(var l=0;l<c.choices.length;l++)"undefined"!=typeof c.multiple_choice&&1==c.multiple_choice?k.push('<li><input type="checkbox" name="pafb_feedbacks[pafb_answer]['+d+"]["+b+'][]" value="'+c.choices[l]+'" id="'+b+"_"+d+"_"+l+'" /> <label for="'+b+"_"+d+"_"+l+'">'+c.choices[l]+"</label></li>"):k.push('<li><input type="radio" name="pafb_feedbacks[pafb_answer]['+d+"]["+b+']" value="'+c.choices[l]+'" id="'+b+"_"+d+"_"+l+'"/>  <label for="'+b+"_"+d+"_"+l+'">'+c.choices[l]+"</label></li>");k.push("</ul>"),h.push(['<li data-progress="'+j+'" data-type="'+b+'" data-required="'+i+'" data-column="'+c.column+'" >','<span class="pafb-survey-question">'+c.question+"</span>",k.join(""),"</li>"].join(""));break;case"rating":var m=[];m.push('<ul class="pafb-rating-karma">'),m.push("<li><span>"+c.negative+"</span></li>"),m.push("<li><span>"+c.positive+"</span></li>"),m.push("</ul>"),m.push('<ul class="pafb-rating-items">');for(var l=0;l<c.rating_range;l++)m.push('<li><input type="radio" name="pafb_feedbacks[pafb_answer]['+d+"]["+b+']" value="'+(l+1)+'" id="'+b+"_"+d+"_"+l+'" /> <label for="'+b+"_"+d+"_"+l+'">'+(l+1)+"</label></li>");m.push("</ul>"),h.push(['<li data-progress="'+j+'" data-type="'+b+'" data-required="'+i+'" data-column="'+c.column+'" >','<span class="pafb-survey-question">'+c.question+"</span>",m.join(""),"</li>"].join(""));break;case"email":h.push(['<li data-progress="'+j+'" data-type="'+b+'" data-required="'+i+'" data-column="'+c.column+'" >','<span class="pafb-survey-question">'+c.question+"</span>",'<input type="text" name="pafb_feedbacks[pafb_answer]['+d+"]["+b+']" placeholder="'+c.placeholder_text+'"/>',"</li>"].join(""));break;case"singlefield":h.push(['<li data-progress="'+j+'" data-type="'+b+'" data-required="'+i+'" data-column="'+c.column+'" >','<span class="pafb-survey-question">'+c.question+"</span>",'<input type="text" name="pafb_feedbacks[pafb_answer]['+d+"]["+b+']" placeholder="'+c.placeholder_text+'"/>',"</li>"].join(""));break;case"multiplefield":h.push(['<li data-progress="'+j+'" data-type="'+b+'" data-required="'+i+'" data-column="'+c.column+'" >','<span class="pafb-survey-question">'+c.question+"</span>",'<textarea name="pafb_feedbacks[pafb_answer]['+d+"]["+b+']" placeholder="'+c.placeholder_text+'"></textarea>',"</li>"].join(""));break;case"confirmation":h.push(['<li style="display:none;" data-progress="'+j+'" data-type="'+b+'" data-required="'+i+'" data-column="'+c.column+'" >','<span class="pafb-survey-question">'+c.confirmation+"</span>","</li>"].join(""))}g.append(h.join(""))},survey_validate_answer:function(a,b,c){switch(a){case"positive-negative":if(b&&c.find("input[type=radio]:checked").size()<=0)return!1;break;case"choice":if(b&&c.find("input[type=radio]:checked").size()<=0&&c.find("input[type=checkbox]:checked").size()<=0)return!1;break;case"rating":if(b&&c.find("input[type=radio]:checked").size()<=0)return!1;break;case"email":if(b&&(""==c.find("input[type=text]").val()||!c.find("input[type=text]").validEmail()))return!1;break;case"singlefield":if(b&&""==c.find("input[type=text]").val())return!1;break;case"multiplefield":if(b&&""==c.find("textarea").val())return!1}return c.attr("has-answer",!0),!0},survey_feedbacks_save:function(b,c){var d={};a.each(b,function(){var b=a(this),c=b.data("type"),e=b.data("column");switch(console.log(e),c){case"positive-negative":d[e]=b.find("input[type=radio]:checked").val();break;case"choice":if(b.find("input[type=radio]:checked").size()>0)d[e]=b.find("input[type=radio]:checked").val();else if(b.find("input[type=checkbox]:checked").size()>0){var f=b.find("input[type=checkbox]:checked").map(function(){return this.value}).get();d[e]=f.join(",")}break;case"rating":d[e]=b.find("input[type=radio]:checked").val();break;case"email":d[e]=b.find("input[type=text]").val();break;case"singlefield":d[e]=b.find("input[type=text]").val();break;case"multiplefield":d[e]=b.find("textarea").val()}});var e=parseInt(a("div[data-pafb-id="+c+"]").data("post-id")),f=parseInt(a("div[data-pafb-id="+c+"]").data("pafb-shortcode"));a.post(pafb_ajax_url,{action:"pafb_save_feedback",fb:d,survey_id:c,post_ID:e,is_shortcode:f}).error(function(a){console.log(a)})}}},c={fire:function(a,c,d){var e=b;c=void 0===c?"init":c,""!==a&&e[a]&&"function"==typeof e[a][c]&&e[a][c](d)},loadEvents:function(){c.fire("common"),a.each(document.body.className.replace(/-/g,"_").split(/\s+/),function(a,b){c.fire(b)})}};a.fn.shuffle=function(){return this.each(function(){var b=a(this).children().clone(!0);return b.length?a(this).html(a.shuffle(b)):this})},a.shuffle=function(a){for(var b,c,d=a.length;d;b=parseInt(Math.random()*d),c=a[--d],a[d]=a[b],a[b]=c);return a},a.fn.validEmail=function(b){function c(a){if(a.is("input,textarea")){var b=/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i;return b.test(a.val())}return!1}function d(a){c(a)?f.call(a.get(0)):g.call(a.get(0))}b=b||{};var e=b.on,f=b.success||function(){},g=b.failure||function(){},h=b.testInitially||!1,i=a(this);return"string"==typeof e&&i.bind(e,function(){d(a(this))}),h&&i.each(function(){d(a(this))}),c(i)},a(document).ready(c.loadEvents)}(jQuery);